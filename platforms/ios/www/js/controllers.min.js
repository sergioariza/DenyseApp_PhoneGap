app.controller("mainController",function(){}),app.controller("newsController",function($scope,$rootScope,$location,$timeout,ApiServices){var gotAllNews=!1,beginIndex=0,endIndex=9,isCallingService=!1,getAllNews=function(beginIndex,endIndex,reset){ApiServices.getAllNews("sergioariza@outlook.com",beginIndex,endIndex).success(function(data){data.length<endIndex-beginIndex+1?(gotAllNews=!0,$(".lastRowLabel").text("No hay más noticias")):(gotAllNews=!1,$(".lastRowLabel").text("¿Más noticias?")),$rootScope.news=reset?data:$rootScope.news.concat(data),isCallingService=!1}).error(function(){isCallingService=!1})};$rootScope.news||getAllNews(beginIndex,endIndex,!0),$(".scroll-content").scroll(function(){$(this).scrollTop()+$(this).innerHeight()+5>=this.scrollHeight&&(isCallingService||gotAllNews||(console.log("Calling for more news!!!"),beginIndex+=10,endIndex+=10,isCallingService=!0,getAllNews(beginIndex,endIndex,!1)))}),$scope.doRefresh=function(){console.log("Refreshing news!"),$timeout(function(){beginIndex=0,endIndex=9,getAllNews(beginIndex,endIndex,!0)},100),$scope.$broadcast("scroll.refreshComplete")},$scope.$on("ngRepeatNewsFinished",function(){for(var p=$(".newsBodyContainer p"),divh=$(".newsBodyContainer").height(),index=0,totalNews=p.length;totalNews>index;){for(;angular.element("#"+p[index].id).prop("offsetHeight")>divh;)angular.element("#"+p[index].id).text(function(index,text){return text.replace(/\W*\s(\S)*$/,"...")});index++}}),$scope.go=function(path){$location.url(path)}}),app.controller("newsDetailsController",function($scope,$rootScope,ModelFactory,$routeParams){$scope.newsDetails=ModelFactory.findById($rootScope.news,$routeParams.newsId)}),app.controller("showsController",function($scope,$rootScope,$location,$timeout,ApiServices){var gotAllShows=!1,beginIndex=0,endIndex=9,isCallingService=!1,getAllShows=function(beginIndex,endIndex,reset){ApiServices.getAllShows("demo@demo.com",beginIndex,endIndex).success(function(data){data.length<endIndex-beginIndex+1?(gotAllShows=!0,$(".lastRowLabel").text("No hay más conciertos")):(gotAllShows=!1,$(".lastRowLabel").text("¿Más conciertos?")),$rootScope.shows=reset?data:$rootScope.shows.concat(data),isCallingService=!1}).error(function(){isCallingService=!1})};$rootScope.shows||getAllShows(beginIndex,endIndex,!0),$(".scroll-content").scroll(function(){$(this).scrollTop()+$(this).innerHeight()+5>=this.scrollHeight&&(isCallingService||gotAllShows||(console.log("Calling for more shows!!!"),beginIndex+=10,endIndex+=10,isCallingService=!0,getAllShows(beginIndex,endIndex,!1)))}),$scope.doRefresh=function(){console.log("Refreshing shows!"),$timeout(function(){beginIndex=0,endIndex=9,getAllShows(beginIndex,endIndex,!0)},100),$scope.$broadcast("scroll.refreshComplete")},$scope.go=function(path){$location.url(path)}}),app.controller("showsDetailsController",function($scope,$rootScope,ModelFactory,$routeParams){$scope.showsDetails=ModelFactory.findById($rootScope.shows,$routeParams.showsId);var map,geocoder=new google.maps.Geocoder;geocoder.geocode({address:$scope.showsDetails.linkGoogleMaps},function(results,status){if(status==google.maps.GeocoderStatus.OK){$("#map-canvas").show();var latlng=new google.maps.LatLng(results[0].geometry.location.k,results[0].geometry.location.D),mapOptions={zoom:16,center:latlng};map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),map.setCenter(results[0].geometry.location);{new google.maps.Marker({map:map,position:results[0].geometry.location})}}else $("#map-canvas").hide()})}),app.controller("videosController",function($scope,$window,$rootScope,$location,$timeout,ApiServices){var gotAllVideos=!1,beginIndex=0,endIndex=9,isCallingService=!1,getAllVideos=function(beginIndex,endIndex,reset){ApiServices.getAllVideos("demo@demo.com",beginIndex,endIndex).success(function(data){data.length<endIndex-beginIndex+1?(gotAllVideos=!0,$(".lastRowLabel").text("No hay más vídeos")):(gotAllVideos=!1,$(".lastRowLabel").text("¿Más vídeos?")),$rootScope.videos=reset?data:$rootScope.videos.concat(data),isCallingService=!1}).error(function(){isCallingService=!1})};$rootScope.videos||getAllVideos(beginIndex,endIndex,!0),$(".scroll-content").scroll(function(){$(this).scrollTop()+$(this).innerHeight()+5>=this.scrollHeight&&(isCallingService||gotAllVideos||(console.log("Calling for more videos!!!"),beginIndex+=10,endIndex+=10,isCallingService=!0,getAllVideos(beginIndex,endIndex,!1)))}),$scope.doRefresh=function(){console.log("Refreshing videos!"),$timeout(function(){beginIndex=0,endIndex=9,getAllVideos(beginIndex,endIndex,!0)},100),$scope.$broadcast("scroll.refreshComplete")}}),app.controller("videosItemController",function($scope,$http){var id=$scope.$parent.x.youtubeURL.match("[\\?&]v=([^&#]*)");id=id[1],$http.get("https://www.googleapis.com/youtube/v3/videos?id="+id+"&key=AIzaSyDf3_B7JrBwhqJreIE4uVeSWP4BYb_Mwd0%20&fields=items(statistics)&part=statistics").success(function(data){var numViews=data.items[0].statistics.viewCount,thumb_url="http://i.ytimg.com/vi/"+id+"/mqdefault.jpg";$('<img src="'+thumb_url+'" class="imageYoutubeURL" />').appendTo($(".videoPreviewContainer")),$("<p>"+numViews+" visitas</p>").appendTo($(".videoDescriptionContainer")),$(".imageYoutubeURL").width("100%");var totalHeight=30;$(".videoDescriptionContainer p").each(function(){totalHeight+=$(this).height()}),$(".videoPreviewContainer").css("height",totalHeight),$(".videoDescriptionContainer").css("height",totalHeight)}).error(function(){})});